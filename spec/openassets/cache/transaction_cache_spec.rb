require 'spec_helper'
describe OpenAssets::Cache::TransactionCache do

  subject{
    OpenAssets::Cache::TransactionCache.new({:cache_provider => {:adapter => 'sqlite', :path => ':memory:'}})
  }

  it 'get' do
    expect(subject.get('41fbb44dd78a11f8a1188983dfd63e70e47be94f7e644d20e2e673e811535bde')).to be nil
  end

  it 'put' do
    txid = '7ed86d1c2824ea14bf8a2fe27202a1d229a4f58db52e2ba1ed13cf36765deaac'
    serialized_tx = '0100000006106948b5ad069587da671acd3a1c71059e196516214645bd4728adb716dd8768010000006b483045022100b9e0cb64360c13299be81f2a8c07334e2913f2273f75ccfb919d48b83488ecb00220791aa7e596559be4acc9ce92141775b54d2c4017ddc7a6c2fd37b427c1d07d8c012102f61508529d9676dac201761069ba10eaf546586874e136b02e5d31e9880b5a2affffffff106948b5ad069587da671acd3a1c71059e196516214645bd4728adb716dd8768020000006a473044022030bf90882f9d22dfb13c782ecbe27ada99f8339a2ad780f0780691625c95f426022005246378a8d26ff56ceb6da210fa9e773b0639e12795f51c3cf96986be74c681012102f61508529d9676dac201761069ba10eaf546586874e136b02e5d31e9880b5a2affffffff106948b5ad069587da671acd3a1c71059e196516214645bd4728adb716dd8768030000006b483045022100fba1072d96a3972838dc1503de4509dd4b8c2ba365bea68a8d5c267b2104ede50220688f2e3d4f529b3921884d3b22f6ec26486ce432a8caaf20e45b0d24501d8ffc012102f61508529d9676dac201761069ba10eaf546586874e136b02e5d31e9880b5a2affffffff6f2db9cb1eac348ae672c39b92d5ef290c3cee89b3f06776e40558a9dd6cce9e010000006b483045022100c47feb60db13996e8c2bb46f7053733389385499b17c8ff10f5a23b21cc96be602200a4d4f66115a1b009c64b33e89b867afe3bcc516dda67e5cfe10c510f3465483012102f61508529d9676dac201761069ba10eaf546586874e136b02e5d31e9880b5a2affffffff6f2db9cb1eac348ae672c39b92d5ef290c3cee89b3f06776e40558a9dd6cce9e020000006b48304502210086eb2186d4728b641b392aecaef752a5938e791e4a5b8aa4b6c31a05f88c25c802202cfdc7ce96624f2f667854c12abc969cbd9a31197b7f557cf4d94ee3a1e4e9a0012102f61508529d9676dac201761069ba10eaf546586874e136b02e5d31e9880b5a2affffffff5caa4a08ae0ef0e765e95d8fca4d53bd6e3d5496f941cb8a42f1be453ba78e30010000006a47304402201285dcba61a3524ff6146157a14b354d0b8ed4480793186ccb9fb4196b68d49302205587cad2dc7f1d7cd1044cf5705748810388313182893a82140e8657cbe1a48a012102f61508529d9676dac201761069ba10eaf546586874e136b02e5d31e9880b5a2affffffff0600000000000000000c6a0a4f41010004321604020058020000000000001976a914fa7491ee214ab15241a613fb5906f6df996bb08b88ac58020000000000001976a9147d8dd16cc3413a64a9964c91cb0ee9358ab1dff688ac58020000000000001976a914fa7491ee214ab15241a613fb5906f6df996bb08b88ac58020000000000001976a9147d8dd16cc3413a64a9964c91cb0ee9358ab1dff688ace8610100000000001976a9147d8dd16cc3413a64a9964c91cb0ee9358ab1dff688ac00000000'
    subject.put(txid, serialized_tx)
    subject.put('9ece6cdda95805e47667f0b389ee3c0c29efd5929bc372e68a34ac1ecbb92d6f', '0100000002bab7d2b0bfdd11bb8e7757bc575398bbaa8f30110f56590e1bf2dfff0c210c37000000006b483045022100ef7e82e77372407da5586acd77cf61a9d7682782b7ead0450ae220d07913555c0220101cb1a026a4c81204a01ec0c02e237f0d0c22f31fd87030e85640f1a53a2d5c0121033917dfab0a99833380034fa77159a812feb8333382e53075b88dcbebfde7cc49ffffffffbab7d2b0bfdd11bb8e7757bc575398bbaa8f30110f56590e1bf2dfff0c210c37020000006b483045022100ae225c601583b1e8cf6190ac6f7ae32df94aeb347d6bb7d17ee98532b94e9379022010718ac1a2c68a21e1f80bdd7f7fcd42866d50006ecdcda341cc8c40419403770121033917dfab0a99833380034fa77159a812feb8333382e53075b88dcbebfde7cc49ffffffff0600000000000000000d6a0b4f41010004030304de070058020000000000001976a9147d8dd16cc3413a64a9964c91cb0ee9358ab1dff688ac58020000000000001976a9147d8dd16cc3413a64a9964c91cb0ee9358ab1dff688ac58020000000000001976a9147d8dd16cc3413a64a9964c91cb0ee9358ab1dff688ac58020000000000001976a914a938dad89bbd964cbaf5d9059e0bda1d900ce08388ac202f0100000000001976a914a938dad89bbd964cbaf5d9059e0bda1d900ce08388ac00000000')
    expect(subject.get(txid)).to eq(serialized_tx)
  end

end